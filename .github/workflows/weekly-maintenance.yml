name: ðŸ”§ Weekly Maintenance & Health Check

on:
  # æ¯Žé€±æ—¥æ›œæ—¥ 3:00 AM JST (åœŸæ›œæ—¥ 18:00 UTC) ã«å®Ÿè¡Œ
  schedule:
    - cron: '0 18 * * 6'

  # æ‰‹å‹•å®Ÿè¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³
  workflow_dispatch:
    inputs:
      maintenance_type:
        description: 'ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç¨®é¡ž'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - security-only
          - dependency-only
          - health-check-only

env:
  NODE_VERSION: '20'

jobs:
  # === ä¾å­˜é–¢ä¿‚æ›´æ–°ãƒã‚§ãƒƒã‚¯ ===
  dependency-check:
    name: ðŸ“¦ ä¾å­˜é–¢ä¿‚æ›´æ–°ãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    if: github.event.inputs.maintenance_type == 'full' || github.event.inputs.maintenance_type == 'dependency-only' || github.event_name == 'schedule'
    timeout-minutes: 15

    steps:
      - name: ðŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ðŸ”§ Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ ç¾åœ¨ã®ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯
        run: |
          echo "## ðŸ“¦ ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯çµæžœ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # å¤ã„ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯
          echo "### ðŸ•°ï¸ æ›´æ–°å¯èƒ½ãªä¾å­˜é–¢ä¿‚" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          npm outdated >> $GITHUB_STEP_SUMMARY || echo "ã™ã¹ã¦æœ€æ–°ã§ã™" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

          # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»" >> $GITHUB_STEP_SUMMARY
          if npm audit --audit-level=moderate; then
            echo "âœ… **ä¸­ãƒªã‚¹ã‚¯ä»¥ä¸Šã®è„†å¼±æ€§**: ãªã—" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **ä¸­ãƒªã‚¹ã‚¯ä»¥ä¸Šã®è„†å¼±æ€§**: æ¤œå‡º" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            npm audit --audit-level=moderate >> $GITHUB_STEP_SUMMARY || true
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

  # === ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ ===
  security-scan:
    name: ðŸ”’ åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
    runs-on: ubuntu-latest
    if: github.event.inputs.maintenance_type == 'full' || github.event.inputs.maintenance_type == 'security-only' || github.event_name == 'schedule'
    timeout-minutes: 20

    steps:
      - name: ðŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ðŸ”§ Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm ci

      - name: ðŸ” ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆESLint ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼‰
        run: |
          echo "## ðŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³çµæžœ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®ESLintãƒ«ãƒ¼ãƒ«ã§ã‚¹ã‚­ãƒ£ãƒ³
          if npx eslint src/ --ext .ts,.tsx --no-eslintrc --config .eslintrc.json; then
            echo "âœ… **ESLint ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯**: å•é¡Œãªã—" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **ESLint ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯**: è­¦å‘Šã‚ã‚Š" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

      - name: ðŸ” ç’°å¢ƒå¤‰æ•°ãƒ»æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ” æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯" >> $GITHUB_STEP_SUMMARY

          # ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ç°¡æ˜“ãƒã‚§ãƒƒã‚¯
          SECRET_PATTERNS="(password|secret|key|token|api_key).*=.*['\"][^'\"]*['\"]"

          if grep -r -i -E "$SECRET_PATTERNS" src/ --include="*.ts" --include="*.tsx" --exclude-dir=node_modules; then
            echo "âš ï¸ **æ©Ÿå¯†æƒ…å ±ã®å¯èƒ½æ€§**: æ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼ˆè¦ç¢ºèªï¼‰" >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… **æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯**: å•é¡Œãªã—" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

  # === ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ===
  health-check:
    name: ðŸ¥ ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    if: github.event.inputs.maintenance_type == 'full' || github.event.inputs.maintenance_type == 'health-check-only' || github.event_name == 'schedule'
    timeout-minutes: 25

    steps:
      - name: ðŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ðŸ”§ Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm ci

      - name: ðŸ—ï¸ ãƒ“ãƒ«ãƒ‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        run: |
          echo "## ðŸ¥ ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæžœ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # ãƒ“ãƒ«ãƒ‰æ™‚é–“æ¸¬å®š
          echo "### âš¡ ãƒ“ãƒ«ãƒ‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹" >> $GITHUB_STEP_SUMMARY

          START_TIME=$(date +%s)
          npm run build
          END_TIME=$(date +%s)
          BUILD_TIME=$((END_TIME - START_TIME))

          echo "- **ãƒ“ãƒ«ãƒ‰æ™‚é–“**: ${BUILD_TIME}ç§’" >> $GITHUB_STEP_SUMMARY

          if [ $BUILD_TIME -gt 120 ]; then
            echo "- âš ï¸ **ãƒ“ãƒ«ãƒ‰æ™‚é–“è­¦å‘Š**: 2åˆ†ã‚’è¶…ãˆã¦ã„ã¾ã™" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âœ… **ãƒ“ãƒ«ãƒ‰æ™‚é–“**: æ­£å¸¸ç¯„å›²" >> $GITHUB_STEP_SUMMARY
          fi
        env:
          SKIP_ENV_VALIDATION: true

      - name: ðŸ“Š ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºåˆ†æž
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¦ ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºåˆ†æž" >> $GITHUB_STEP_SUMMARY

          # .next/static ã®ã‚µã‚¤ã‚ºç¢ºèª
          if [ -d ".next/static" ]; then
            BUNDLE_SIZE=$(du -sh .next/static | cut -f1)
            echo "- **é™çš„ã‚¢ã‚»ãƒƒãƒˆã‚µã‚¤ã‚º**: $BUNDLE_SIZE" >> $GITHUB_STEP_SUMMARY
            
            # å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
            echo "- **å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ500KBä»¥ä¸Šï¼‰**:" >> $GITHUB_STEP_SUMMARY
            find .next/static -size +500k -type f -exec ls -lh {} \; | awk '{print "  - " $9 ": " $5}' >> $GITHUB_STEP_SUMMARY || echo "  - ãªã—" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

      - name: ðŸŒ æœ¬ç•ªã‚µã‚¤ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¸¬å®š
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŒ æœ¬ç•ªã‚µã‚¤ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹" >> $GITHUB_STEP_SUMMARY

          # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ¸¬å®š
          PRODUCTION_URL="https://shutter-hub-v2.vercel.app"

          echo "ðŸ” æ¸¬å®šå¯¾è±¡: $PRODUCTION_URL"

          if RESPONSE_TIME=$(curl -o /dev/null -s -w '%{time_total}' "$PRODUCTION_URL" 2>/dev/null); then
            echo "- **ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: ${RESPONSE_TIME}ç§’" >> $GITHUB_STEP_SUMMARY
            
            # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹åˆ¤å®š
            if (( $(echo "$RESPONSE_TIME > 3.0" | bc -l) )); then
              echo "- âš ï¸ **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“è­¦å‘Š**: 3ç§’ã‚’è¶…ãˆã¦ã„ã¾ã™" >> $GITHUB_STEP_SUMMARY
            else
              echo "- âœ… **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: æ­£å¸¸ç¯„å›²" >> $GITHUB_STEP_SUMMARY
            fi
          else
            echo "- âš ï¸ **æŽ¥ç¶šã‚¨ãƒ©ãƒ¼**: æœ¬ç•ªã‚µã‚¤ãƒˆã«æŽ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

  # === ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ===
  database-health:
    name: ðŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    if: github.event.inputs.maintenance_type == 'full' || github.event.inputs.maintenance_type == 'health-check-only' || github.event_name == 'schedule'
    timeout-minutes: 10

    steps:
      - name: ðŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ðŸ—„ï¸ SupabaseæŽ¥ç¶šãƒã‚§ãƒƒã‚¯
        run: |
          echo "## ðŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæžœ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Supabase APIæŽ¥ç¶šç¢ºèª
          SUPABASE_URL="${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}"

          if [ -n "$SUPABASE_URL" ]; then
            echo "ðŸ” SupabaseæŽ¥ç¶šç¢ºèª: $SUPABASE_URL"
            
            # REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
            if curl -f -s "${SUPABASE_URL}/rest/v1/" > /dev/null; then
              echo "âœ… **Supabase REST API**: æŽ¥ç¶šæˆåŠŸ" >> $GITHUB_STEP_SUMMARY
            else
              echo "âŒ **Supabase REST API**: æŽ¥ç¶šå¤±æ•—" >> $GITHUB_STEP_SUMMARY
            fi
            
            # Auth API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
            if curl -f -s "${SUPABASE_URL}/auth/v1/settings" > /dev/null; then
              echo "âœ… **Supabase Auth API**: æŽ¥ç¶šæˆåŠŸ" >> $GITHUB_STEP_SUMMARY
            else
              echo "âŒ **Supabase Auth API**: æŽ¥ç¶šå¤±æ•—" >> $GITHUB_STEP_SUMMARY
            fi
          else
            echo "âš ï¸ **Supabase URL**: è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

  # === E2Eãƒ†ã‚¹ãƒˆï¼ˆãƒ©ã‚¤ãƒˆç‰ˆï¼‰ ===
  light-e2e-test:
    name: ðŸŽ­ è»½é‡E2Eãƒ†ã‚¹ãƒˆ
    runs-on: ubuntu-latest
    if: github.event.inputs.maintenance_type == 'full' || github.event_name == 'schedule'
    timeout-minutes: 20

    steps:
      - name: ðŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ðŸ”§ Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm ci

      - name: ðŸŽ­ Playwright ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        run: npx playwright install --with-deps chromium

      - name: ðŸ—ï¸ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
        run: npm run build
        env:
          SKIP_ENV_VALIDATION: true

      - name: ðŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
        run: npm start &
        env:
          NODE_ENV: test
          SKIP_ENV_VALIDATION: true

      - name: â³ èµ·å‹•å¾…æ©Ÿ
        run: |
          for i in {1..30}; do
            if curl -f http://localhost:8888 > /dev/null 2>&1; then
              echo "âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•å®Œäº†"
              break
            fi
            sleep 2
          done

      - name: ðŸŽ­ åŸºæœ¬E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        run: |
          echo "## ðŸŽ­ è»½é‡E2Eãƒ†ã‚¹ãƒˆçµæžœ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # åŸºæœ¬çš„ãªãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
          MCP_ENABLED=true \
          TEST_OAUTH_MOCK_ENABLED=true \
          npx playwright test instant-photo-request.spec.ts \
            --project=chromium \
            --grep="åŸºæœ¬ã‚¢ã‚¯ã‚»ã‚¹|ãƒšãƒ¼ã‚¸è¡¨ç¤º" \
            --reporter=line
        env:
          PLAYWRIGHT_BASE_URL: http://localhost:8888
          TEST_OAUTH_MOCK_ENABLED: true
        continue-on-error: true

  # === ãƒ¬ãƒãƒ¼ãƒˆé›†ç´„ ===
  summary:
    name: ðŸ“Š é€±æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å ±å‘Š
    runs-on: ubuntu-latest
    if: always()
    needs:
      [
        dependency-check,
        security-scan,
        health-check,
        database-health,
        light-e2e-test,
      ]
    timeout-minutes: 5

    steps:
      - name: ðŸ“Š é€±æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†å ±å‘Š
        run: |
          echo "# ðŸ”§ é€±æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†å ±å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**å®Ÿè¡Œæ—¥æ™‚**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "**ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç¨®é¡ž**: ${{ github.event.inputs.maintenance_type || 'full (scheduled)' }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # å„ã‚¸ãƒ§ãƒ–ã®å®Ÿè¡Œçµæžœ
          echo "## ðŸ“‹ å®Ÿè¡Œçµæžœã‚µãƒžãƒªãƒ¼" >> $GITHUB_STEP_SUMMARY

          # ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯
          if [ "${{ needs.dependency-check.result }}" = "success" ]; then
            echo "âœ… **ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯**: å®Œäº†" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.dependency-check.result }}" = "skipped" ]; then
            echo "â­ï¸ **ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯**: ã‚¹ã‚­ãƒƒãƒ—" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯**: è­¦å‘Šã‚ã‚Š" >> $GITHUB_STEP_SUMMARY
          fi

          # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
          if [ "${{ needs.security-scan.result }}" = "success" ]; then
            echo "âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³**: å®Œäº†" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.security-scan.result }}" = "skipped" ]; then
            echo "â­ï¸ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³**: ã‚¹ã‚­ãƒƒãƒ—" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³**: è­¦å‘Šã‚ã‚Š" >> $GITHUB_STEP_SUMMARY
          fi

          # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
          if [ "${{ needs.health-check.result }}" = "success" ]; then
            echo "âœ… **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: å®Œäº†" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.health-check.result }}" = "skipped" ]; then
            echo "â­ï¸ **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: ã‚¹ã‚­ãƒƒãƒ—" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: è­¦å‘Šã‚ã‚Š" >> $GITHUB_STEP_SUMMARY
          fi

          # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ˜ãƒ«ã‚¹
          if [ "${{ needs.database-health.result }}" = "success" ]; then
            echo "âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ˜ãƒ«ã‚¹**: å®Œäº†" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.database-health.result }}" = "skipped" ]; then
            echo "â­ï¸ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ˜ãƒ«ã‚¹**: ã‚¹ã‚­ãƒƒãƒ—" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ˜ãƒ«ã‚¹**: è­¦å‘Šã‚ã‚Š" >> $GITHUB_STEP_SUMMARY
          fi

          # E2Eãƒ†ã‚¹ãƒˆ
          if [ "${{ needs.light-e2e-test.result }}" = "success" ]; then
            echo "âœ… **è»½é‡E2Eãƒ†ã‚¹ãƒˆ**: å®Œäº†" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.light-e2e-test.result }}" = "skipped" ]; then
            echo "â­ï¸ **è»½é‡E2Eãƒ†ã‚¹ãƒˆ**: ã‚¹ã‚­ãƒƒãƒ—" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **è»½é‡E2Eãƒ†ã‚¹ãƒˆ**: è­¦å‘Šã‚ã‚Š" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸŽ¯ æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³" >> $GITHUB_STEP_SUMMARY
          echo "- è­¦å‘ŠãŒã‚ã‚‹é …ç›®ã¯æ™‚é–“ãŒã‚ã‚‹æ™‚ã«ç¢ºèªã—ã¦ãã ã•ã„" >> $GITHUB_STEP_SUMMARY
          echo "- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã¯å„ªå…ˆçš„ã«å¯¾å¿œã—ã¦ãã ã•ã„" >> $GITHUB_STEP_SUMMARY
          echo "- ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ã¯å®šæœŸçš„ã«è¡Œã£ã¦ãã ã•ã„" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ“… æ¬¡å›žãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹" >> $GITHUB_STEP_SUMMARY
          echo "**äºˆå®š**: æ¬¡ã®æ—¥æ›œæ—¥ 3:00 AM JST (è‡ªå‹•å®Ÿè¡Œ)" >> $GITHUB_STEP_SUMMARY
