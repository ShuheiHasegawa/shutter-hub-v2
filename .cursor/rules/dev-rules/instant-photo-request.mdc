---
description: 
globs: 
alwaysApply: false
---
# å³åº§æ’®å½±ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ©Ÿèƒ½ä»•æ§˜

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ãŸã‚‰ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç™ºè¨€ã™ã‚‹ã“ã¨

## æ©Ÿèƒ½æ¦‚è¦

### ğŸ¯ **ã‚³ãƒ³ã‚»ãƒ—ãƒˆ**
æ—…è¡Œå…ˆã‚„å¤–å‡ºå…ˆã§ã€ãã®å ´ã«ã„ã‚‹ã‚«ãƒ¡ãƒ©ãƒãƒ³ã«å³åº§ã«æ’®å½±ã‚’ä¾é ¼ã§ãã‚‹**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ’®å½±ãƒãƒƒãƒãƒ³ã‚°æ©Ÿèƒ½**

### ğŸ¨ **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼**
- **ä¸€èˆ¬è¦³å…‰å®¢**: æ—…è¡Œå…ˆã§ã®è¨˜å¿µæ’®å½±
- **ã‚«ãƒƒãƒ—ãƒ«ãƒ»å®¶æ—**: ç‰¹åˆ¥ãªç¬é–“ã®æ’®å½±
- **ã‚¤ãƒ³ã‚¹ã‚¿ã‚°ãƒ©ãƒãƒ¼**: SNSæ˜ ãˆã™ã‚‹å†™çœŸæ’®å½±
- **å¤–å›½äººè¦³å…‰å®¢**: æ—¥æœ¬ã§ã®æ€ã„å‡ºä½œã‚Š

## æ©Ÿèƒ½ä»•æ§˜

### ğŸ“± **ã‚²ã‚¹ãƒˆæ©Ÿèƒ½ï¼ˆèªè¨¼ä¸è¦ï¼‰**

#### åŸºæœ¬ãƒ•ãƒ­ãƒ¼
```
1. ä½ç½®æƒ…å ±è¨±å¯ â†’ 2. æ’®å½±ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ â†’ 3. è¿‘ãã®ã‚«ãƒ¡ãƒ©ãƒãƒ³æ¤œç´¢ 
â†’ 4. ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ â†’ 5. ãƒãƒƒãƒãƒ³ã‚° â†’ 6. æ’®å½±å®Ÿè¡Œ â†’ 7. å†™çœŸå—ã‘æ¸¡ã—
```

#### ã‚²ã‚¹ãƒˆåˆ¶é™äº‹é …
- **æ’®å½±å›æ•°**: æœˆ3å›ã¾ã§
- **æ¤œç´¢ç¯„å›²**: åŠå¾„1kmä»¥å†…
- **æ’®å½±æ™‚é–“**: 30åˆ†ä»¥å†…
- **å†™çœŸæšæ•°**: æœ€å¤§20æš
- **æ±ºæ¸ˆæ–¹æ³•**: ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã®ã¿

### ğŸ—ºï¸ **ä½ç½®ãƒ™ãƒ¼ã‚¹æ©Ÿèƒ½**

#### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä½ç½®æƒ…å ±
```typescript
interface LocationData {
  latitude: number;
  longitude: number;
  accuracy: number;
  timestamp: Date;
  address?: string; // é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  landmark?: string; // è¿‘ãã®è¦³å…‰åœ°
}
```

#### å¯¾å¿œã‚¨ãƒªã‚¢ï¼ˆæ®µéšçš„å±•é–‹ï¼‰
```
ãƒ•ã‚§ãƒ¼ã‚º1: æ±äº¬éƒ½å¿ƒéƒ¨ï¼ˆæ¸‹è°·ã€æ–°å®¿ã€åŸå®¿ã€æµ…è‰ï¼‰
ãƒ•ã‚§ãƒ¼ã‚º2: å¤§é˜ªãƒ»äº¬éƒ½ãƒ»ç¥æˆ¸
ãƒ•ã‚§ãƒ¼ã‚º3: å…¨å›½ä¸»è¦è¦³å…‰åœ°
ãƒ•ã‚§ãƒ¼ã‚º4: æµ·å¤–å±•é–‹
```

### ğŸ“¸ **æ’®å½±ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜**

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹
```typescript
interface InstantPhotoRequest {
  id: string;
  location: LocationData;
  requestType: 'portrait' | 'couple' | 'family' | 'group' | 'landscape';
  urgency: 'now' | 'within_30min' | 'within_1hour';
  duration: 15 | 30 | 60; // åˆ†
  budget: number; // å††
  specialRequests?: string;
  guestInfo: {
    name: string;
    phone: string;
    partySize: number;
  };
  status: 'pending' | 'matched' | 'in_progress' | 'completed' | 'cancelled';
  createdAt: Date;
  expiresAt: Date; // 2æ™‚é–“å¾Œã«è‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«
}
```

#### æ–™é‡‘ä½“ç³»
```typescript
const instantPricing = {
  portrait_15min: 3000,    // ãƒãƒ¼ãƒˆãƒ¬ãƒ¼ãƒˆ15åˆ†
  couple_30min: 5000,      // ã‚«ãƒƒãƒ—ãƒ«30åˆ†
  family_30min: 6000,      // å®¶æ—30åˆ†
  group_30min: 8000,       // ã‚°ãƒ«ãƒ¼ãƒ—30åˆ†
  premium_60min: 12000,    // ãƒ—ãƒ¬ãƒŸã‚¢ãƒ 60åˆ†
  
  // è¿½åŠ æ–™é‡‘
  rush_fee: 1000,          // ç·Šæ€¥æ–™é‡‘ï¼ˆ30åˆ†ä»¥å†…ï¼‰
  holiday_fee: 1500,       // ä¼‘æ—¥æ–™é‡‘
  night_fee: 2000,         // å¤œé–“æ–™é‡‘ï¼ˆ18æ™‚ä»¥é™ï¼‰
};
```

### ğŸ‘¨â€ğŸ’¼ **ã‚«ãƒ¡ãƒ©ãƒãƒ³å´æ©Ÿèƒ½**

#### ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ç®¡ç†
```typescript
interface PhotographerStatus {
  userId: string;
  isOnline: boolean;
  currentLocation: LocationData;
  availableUntil: Date;
  acceptingRequests: boolean;
  currentBooking?: string;
  responseRadius: number; // km
  instantRates: {
    portrait: number;
    couple: number;
    family: number;
    group: number;
  };
}
```

#### é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥**: æ–°ã—ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
- **éŸ³å£°ã‚¢ãƒ©ãƒ¼ãƒˆ**: ç·Šæ€¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- **ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ä½ç½®æƒ…å ±æ›´æ–°
- **SMS**: ã‚¢ãƒ—ãƒªæœªèµ·å‹•æ™‚ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### ğŸ”„ **ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **

#### å„ªå…ˆé †ä½
```typescript
const matchingCriteria = {
  distance: 0.4,        // è·é›¢ï¼ˆ40%ï¼‰
  rating: 0.25,         // è©•ä¾¡ï¼ˆ25%ï¼‰
  responseTime: 0.2,    // å¿œç­”é€Ÿåº¦ï¼ˆ20%ï¼‰
  priceMatch: 0.15,     // æ–™é‡‘é©åˆæ€§ï¼ˆ15%ï¼‰
};
```

#### è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°
```
1. åŠå¾„500mä»¥å†…ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚«ãƒ¡ãƒ©ãƒãƒ³æ¤œç´¢
2. äºˆç®—ãƒ»æ™‚é–“ãƒ»æ’®å½±ã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
3. å„ªå…ˆé †ä½ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚½ãƒ¼ãƒˆ
4. ä¸Šä½3åã«åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
5. æœ€åˆã«å¿œç­”ã—ãŸã‚«ãƒ¡ãƒ©ãƒãƒ³ã¨ãƒãƒƒãƒãƒ³ã‚°
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
```sql
-- instant_photo_requests ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE instant_photo_requests (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  guest_name TEXT NOT NULL,
  guest_phone TEXT NOT NULL,
  guest_email TEXT,
  location_lat DECIMAL(10, 8) NOT NULL,
  location_lng DECIMAL(11, 8) NOT NULL,
  location_address TEXT,
  request_type TEXT NOT NULL,
  urgency TEXT NOT NULL,
  duration INTEGER NOT NULL,
  budget INTEGER NOT NULL,
  party_size INTEGER DEFAULT 1,
  special_requests TEXT,
  status TEXT DEFAULT 'pending',
  matched_photographer_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  expires_at TIMESTAMPTZ NOT NULL,
  completed_at TIMESTAMPTZ
);

-- photographer_locations ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä½ç½®æƒ…å ±ï¼‰
CREATE TABLE photographer_locations (
  photographer_id UUID PRIMARY KEY REFERENCES auth.users(id),
  latitude DECIMAL(10, 8) NOT NULL,
  longitude DECIMAL(11, 8) NOT NULL,
  accuracy DECIMAL(5, 2),
  is_online BOOLEAN DEFAULT false,
  available_until TIMESTAMPTZ,
  response_radius INTEGER DEFAULT 1000, -- ãƒ¡ãƒ¼ãƒˆãƒ«
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- instant_bookings ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE instant_bookings (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  request_id UUID REFERENCES instant_photo_requests(id),
  photographer_id UUID REFERENCES auth.users(id),
  start_time TIMESTAMPTZ,
  end_time TIMESTAMPTZ,
  actual_duration INTEGER,
  photos_delivered INTEGER,
  guest_rating INTEGER,
  photographer_rating INTEGER,
  total_amount INTEGER NOT NULL,
  payment_status TEXT DEFAULT 'pending',
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

## UI/UXè¨­è¨ˆ

### ğŸ¨ **ã‚²ã‚¹ãƒˆå‘ã‘UI**

#### ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸
```typescript
// components/instant/InstantPhotoLanding.tsx
export function InstantPhotoLanding() {
  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white">
      <Hero />
      <LocationPermission />
      <QuickRequestForm />
      <HowItWorks />
      <PricingDisplay />
      <TestimonialCarousel />
    </div>
  );
}
```

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒ 
```typescript
// components/instant/QuickRequestForm.tsx
interface QuickRequestFormProps {
  location: LocationData;
}

export function QuickRequestForm({ location }: QuickRequestFormProps) {
  return (
    <Card className="w-full max-w-md mx-auto">
      <CardHeader>
        <CardTitle>ğŸ“¸ ä»Šã™ãæ’®å½±ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</CardTitle>
        <CardDescription>
          {location.address}ã§æ’®å½±ã§ãã‚‹ã‚«ãƒ¡ãƒ©ãƒãƒ³ã‚’æ¢ã—ã¾ã™
        </CardDescription>
      </CardHeader>
      <CardContent>
        <RequestTypeSelector />
        <UrgencySelector />
        <BudgetSlider />
        <GuestInfoForm />
        <SubmitButton />
      </CardContent>
    </Card>
  );
}
```

### ğŸ“± **ã‚«ãƒ¡ãƒ©ãƒãƒ³å‘ã‘UI**

#### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
```typescript
// components/instant/PhotographerDashboard.tsx
export function PhotographerDashboard() {
  return (
    <div className="space-y-6">
      <OnlineStatusToggle />
      <LocationDisplay />
      <IncomingRequestsPanel />
      <EarningsTracker />
      <AvailabilityCalendar />
    </div>
  );
}
```

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€šçŸ¥
```typescript
// components/instant/RequestNotification.tsx
export function RequestNotification({ request }: { request: InstantPhotoRequest }) {
  return (
    <Alert className="border-orange-200 bg-orange-50">
      <Camera className="h-4 w-4" />
      <AlertTitle>æ–°ã—ã„æ’®å½±ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</AlertTitle>
      <AlertDescription>
        <div className="space-y-2">
          <p>{request.requestType} â€¢ {request.duration}åˆ† â€¢ Â¥{request.budget}</p>
          <p>ğŸ“ {request.location.address}</p>
          <div className="flex gap-2">
            <Button size="sm" onClick={() => acceptRequest(request.id)}>
              å—è«¾
            </Button>
            <Button size="sm" variant="outline" onClick={() => declineRequest(request.id)}>
              è¾é€€
            </Button>
          </div>
        </div>
      </AlertDescription>
    </Alert>
  );
}
```

## æŠ€è¡“å®Ÿè£…

### ğŸ—ºï¸ **ä½ç½®æƒ…å ±ãƒ»åœ°å›³æ©Ÿèƒ½**
```typescript
// hooks/useGeolocation.ts
export function useGeolocation() {
  const [location, setLocation] = useState<LocationData | null>(null);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    if (!navigator.geolocation) {
      setError('ä½ç½®æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
      return;
    }

    const watchId = navigator.geolocation.watchPosition(
      (position) => {
        setLocation({
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
          accuracy: position.coords.accuracy,
          timestamp: new Date(),
        });
      },
      (error) => setError(error.message),
      { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
    );

    return () => navigator.geolocation.clearWatch(watchId);
  }, []);

  return { location, error };
}
```

### ğŸ”„ **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡**
```typescript
// lib/realtime/instant-matching.ts
export class InstantMatchingService {
  private supabase = createClient();

  async subscribeToRequests(photographerId: string, callback: (request: InstantPhotoRequest) => void) {
    return this.supabase
      .channel('instant-requests')
      .on('postgres_changes', {
        event: 'INSERT',
        schema: 'public',
        table: 'instant_photo_requests',
        filter: `location_lat=gte.${lat-0.01}&location_lat=lte.${lat+0.01}`,
      }, callback)
      .subscribe();
  }

  async updatePhotographerLocation(photographerId: string, location: LocationData) {
    return this.supabase
      .from('photographer_locations')
      .upsert({
        photographer_id: photographerId,
        latitude: location.latitude,
        longitude: location.longitude,
        accuracy: location.accuracy,
        updated_at: new Date().toISOString(),
      });
  }
}
```

### ğŸ’³ **æ±ºæ¸ˆçµ±åˆ**
```typescript
// lib/payment/instant-payment.ts
export async function processInstantPayment(
  requestId: string,
  amount: number,
  paymentMethod: string
) {
  // Stripe Instant Payment
  const paymentIntent = await stripe.paymentIntents.create({
    amount: amount * 100, // å†† to ã‚»ãƒ³ãƒˆ
    currency: 'jpy',
    metadata: {
      type: 'instant_photo',
      request_id: requestId,
    },
    capture_method: 'manual', // æ’®å½±å®Œäº†å¾Œã«ã‚­ãƒ£ãƒ—ãƒãƒ£
  });

  return paymentIntent;
}
```

## ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«

### ğŸ’° **åç›Šæ§‹é€ **
- **æ‰‹æ•°æ–™**: æ’®å½±æ–™é‡‘ã®20%
- **ã‚²ã‚¹ãƒˆç™»éŒ²ä¿ƒé€²**: 3å›ç›®ä»¥é™ã¯ä¼šå“¡ç™»éŒ²å¿…é ˆ
- **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½**: å„ªå…ˆãƒãƒƒãƒãƒ³ã‚°ã€å†™çœŸç·¨é›†ã‚µãƒ¼ãƒ“ã‚¹
- **è¦³å…‰åœ°ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—**: è¦³å…‰å”ä¼šã¨ã®ææº

### ğŸ“Š **KPIè¨­å®š**
- **ãƒãƒƒãƒãƒ³ã‚°æˆåŠŸç‡**: 80%ä»¥ä¸Š
- **å¹³å‡å¿œç­”æ™‚é–“**: 5åˆ†ä»¥å†…
- **ã‚²ã‚¹ãƒˆâ†’ä¼šå“¡è»¢æ›ç‡**: 30%ä»¥ä¸Š
- **ãƒªãƒ”ãƒ¼ãƒˆåˆ©ç”¨ç‡**: 40%ä»¥ä¸Š

## æ®µéšçš„å®Ÿè£…è¨ˆç”»

### ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆMVPï¼‰
- [ ] åŸºæœ¬çš„ãªã‚²ã‚¹ãƒˆæ©Ÿèƒ½
- [ ] ä½ç½®æƒ…å ±ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒãƒ³ã‚°
- [ ] ç°¡å˜æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ 
- [ ] æ±äº¬éƒ½å¿ƒéƒ¨é™å®š

### ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆæ‹¡å¼µï¼‰
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- [ ] å†™çœŸè‡ªå‹•é…ä¿¡
- [ ] è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ 
- [ ] é–¢è¥¿åœå±•é–‹

### ãƒ•ã‚§ãƒ¼ã‚º3ï¼ˆæœ€é©åŒ–ï¼‰
- [ ] AI ãƒãƒƒãƒãƒ³ã‚°æœ€é©åŒ–
- [ ] å¤šè¨€èªå¯¾å¿œ
- [ ] è¦³å…‰åœ°é€£æº
- [ ] å…¨å›½å±•é–‹

ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ShutterHubã¯**æ’®å½±æ¥­ç•Œã®Uber**ã¨ã—ã¦ä¸€èˆ¬å±¤ã«ã‚‚å¤§ãããƒªãƒ¼ãƒã§ãã¾ã™ï¼
